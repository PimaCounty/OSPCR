function createAddUserDialog(){function n(){$("#userRole").data("kendoDropDownList").select(0);$("#adQueryField").data("kendoMaskedTextBox")===undefined&&$("#adQueryField").kendoMaskedTextBox({mask:"u000000"})}$("#addUserDialog").kendoWindow({draggable:!1,height:"350px",modal:!0,pinned:!1,position:{top:100,left:100},resizable:!1,title:"Add User",width:"500px",visible:!1,open:n});$("#userRole").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:[{text:"Read Only",value:"Read"},{text:"Read/Write",value:"Write"},{text:"Admin",value:"Admin"}],optionlabel:"None"});$("#userRole").data("kendoDropDownList").select(0);$("#addFailureNotification").kendoNotification();$("#confirmAddUser").kendoButton({click:()=>{const n=$("#adQueryField").data("kendoMaskedTextBox").value(),t=`${$("#addUserDialog").data("searchActiveDirectoryUrl")}?UserName=${n}`;SearchForUserGetAddUserAsync(t)}});$("#cancelAddUser").kendoButton({click:()=>{$("#addUserDialog").data("kendoWindow").close()}})}async function SearchForUserGetAddUserAsync(n){const t=$("#addUserDialog").data("addSecurityUserUrl");try{const r=await fetch(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}),u=$("#securityGrid").data().kendoGrid.dataSource.view();let i=null;if(!r.ok){console.log("Error occurred");return}if(r.status!=204&&(i=await r.json().catch(()=>{i=null})),!i){let n=$("#addFailureNotification").kendoNotification().data("kendoNotification");n.warning("This user does not exist.");return}let f=u.some(n=>n.UserName===i.UserName);if(f){let n=$("#addFailureNotification").kendoNotification().data("kendoNotification");n.warning("This user already exists. Unable to add to the system.");return}let e={UserName:i.UserName,RoleName:$("#userRole").data("kendoDropDownList").value(),Email:i.UserEmail,DisplayName:i.DisplayName};const o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)},s=await fetch(t,o);if(!s.ok){$("#kendoErrorNotification").getKendoNotification().show({message:"Error occurred"},"error");return}$("#adQueryField").data("kendoMaskedTextBox").value("");$("#addUserDialog").data("kendoWindow").close();$("#securityGrid").data("kendoGrid").dataSource.read()}catch(i){console.log(i)}}function openAddUserDialog(){$("#addUserDialog").data("kendoWindow").center().open();addUsersTopVal==""&&(addUsersTopVal=$(".k-display-inline-flex").css("top"));addUsersLeftVal==""&&(addUsersLeftVal=$(".k-display-inline-flex").css("left"));addUsersTopVal!=""&&addUsersLeftVal!=""&&$(".k-display-inline-flex").css({top:addUsersTopVal,left:addUsersLeftVal})}function createAdminTabStrip(){$("#adminTabStrip").kendoTabStrip({scrollable:!1,value:"Users"})}function createSecurityGrid(){const t=$("#securityGrid").data("getSecurityUsersUrl"),i=$("#securityGrid").data("updateSecurityUserUrl"),r=$("#securityGrid").data("deleteSecurityUserUrl");let n=new kendo.data.DataSource({transport:{read:{type:"GET",dataType:"json",url:t,cache:!1},update:{type:"POST",dataType:"json",data:"",url:i,cache:!1},destroy:{type:"POST",dataType:"json",data:"",url:r,cache:!1}},schema:{model:{id:"UserName",fields:{UserName:{type:"string",editable:!1},DisplayName:{type:"string",editable:!1},RoleName:{type:"string",editable:!0}}}},pageSize:10,requestEnd:n=>{n.type=="update"&&location.reload()}});$("#securityGrid").kendoGrid({columns:[{field:"DisplayName",title:"Name",editable:!1,filterable:{multi:!0,search:!0}},{field:"UserName",title:"User ID",editable:!1,filterable:{multi:!0,search:!0}},{field:"RoleName",title:"Role",editor:roleDropDownEditor,template:n=>n.RoleName==="Read"?"Read Only":n.RoleName==="Write"?"Read/Write":n.RoleName==="Admin"?"Admin":void 0,filterable:{multi:!0,search:!0}},{command:[{name:"edit"},{name:"Delete",click:t=>{t.preventDefault();let r=$(t.target).closest("tr"),i=$("#securityGrid").data("kendoGrid").dataItem(r);i.id==userName?kendo.alert(`User ${userName} cannot delete user ${i.id}. Please contact an alternate administrator to delete this user.`):kendo.confirm(`Are you sure that you want to delete user ${i.UserName}?`).then(()=>{n.remove(i),n.sync()})}}],title:"&nbsp",width:"200px"}],dataSource:n,editable:"inline",mobile:!0,sortable:!0,filterable:{messages:{search:"Search"}},pageable:{pageSizes:!0},toolbar:[{template:'<a class="k-button" href="javascript:void(0);" onclick="openAddUserDialog()">Add User<\/a>'},{name:"excel"}],excel:{allPages:!0,fileName:"UserRoles.xlsx"}})}function roleDropDownEditor(n,t){$(`<input required name="${t.field}"/>`).appendTo(n).kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:[{text:"Read Only",value:"Read"},{text:"Read/Write",value:"Write"},{text:"Admin",value:"Admin"}]})}let addUsersTopVal,addUsersLeftVal;$(document).ready(()=>{$("#adminicon").addClass("highlighted"),createAdminTabStrip(),createSecurityGrid(),createAddUserDialog(),addUsersTopVal="",addUsersLeftVal=""});